<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content=
    "text/html; charset=UTF-8"></meta>

    <title>
      OpenCT Manual
    </title>

    <link rel="stylesheet" href="openct.css" type="text/css">
    </link>

    <meta name="generator" content=
    "DocBook XSL Stylesheets V1.64.1"></meta>
  </head>

  <body>
    <div class="book" lang="en" xml:lang="en">
      <div class="titlepage">
        <div>
          <div>
            <h1 class="title">
              <a id="openct"></a>OpenCT Manual
            </h1>
          </div>

          <div>
            <div class="author">
              <h3 class="author">
                <span class="firstname">
                  Andreas
                </span>

                <span class="surname">
                  Jellinghaus
                </span>
              </h3>

              <tt class="email">
                &lt;

                <a href="mailto:aj@dungeon.inka.de">
                  aj@dungeon.inka.de
                </a>&gt;
              </tt>
            </div>
          </div>
        </div>

        <div></div>

        <hr></hr>
      </div>

      <div class="toc">
        <p>
          <b>
            Table of Contents
          </b>
        </p>

        <dl>
          <dt>
            <span class="chapter">
              <a href="#openct.about">
                1. About OpenCT
              </a>
            </span>
          </dt>

          <dt>
            <span class="chapter">
              <a href="#openct.copyright">
                2. Copyright and license
              </a>
            </span>
          </dt>

          <dt>
            <span class="chapter">
              <a href="#openct.supported">
                3. Supported readers and tokens
              </a>
            </span>
          </dt>

          <dt>
            <span class="chapter">
              <a href="#openct.requirements">
                4. Requirements
              </a>
            </span>
          </dt>

          <dt>
            <span class="chapter">
              <a href="#openct.install">
                5. Installation
              </a>
            </span>
          </dt>

          <dt>
            <span class="chapter">
              <a href="#openct.debug">
                6. Debugging
              </a>
            </span>
          </dt>

          <dt>
            <span class="chapter">
              <a href="#openct.files">
                7. OpenCT files and tools
              </a>
            </span>
          </dt>

          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="#openct.files.varrunopenct">
                    /var/run/openct - OpenCT status directory
                  </a>
                </span>
              </dt>

              <dt>
                <span class="section">
                  <a href="#openct.files.sbinopenctcontrol">
                    sbin/openct-control - OpenCT manager
                  </a>
                </span>
              </dt>

              <dt>
                <span class="section">
                  <a href="#openct.files.sbinifdhandler">
                    sbin/ifdhandler - OpenCT device handler
                  </a>
                </span>
              </dt>

              <dt>
                <span class="section">
                  <a href="#openct.files.opencttool">
                    bin/openct-tool
                  </a>
                </span>
              </dt>

              <dt>
                <span class="section">
                  <a href="#openct.files.openctconf">
                    etc/openct.conf
                  </a>
                </span>
              </dt>
            </dl>
          </dd>

          <dt>
            <span class="chapter">
              <a href="#openct.ct-api">
                8. Using OpenCT via CT-API interface
              </a>
            </span>
          </dt>

          <dt>
            <span class="chapter">
              <a href="#openct.pcsc">
                9. Using OpenCT via PC/SC Lite
              </a>
            </span>
          </dt>

          <dt>
            <span class="chapter">
              <a href="#openct.library">
                10. Writing smart card applications using OpenCT
              </a>
            </span>
          </dt>

          <dt>
            <span class="chapter">
              <a href="#openct.trouble">
                11. Troubleshooting
              </a>
            </span>
          </dt>

          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="#openct.trouble.usb">
                    Problems with USB devices
                  </a>
                </span>
              </dt>
            </dl>
          </dd>

          <dt>
            <span class="chapter">
              <a href="#openct.security">
                12. Security
              </a>
            </span>
          </dt>
        </dl>
      </div>

      <div class="chapter" lang="en" xml:lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title">
                <a id="openct.about"></a>Chapter&#160;1.&#160;About
                OpenCT
              </h2>
            </div>
          </div>

          <div></div>
        </div>

        <p>
          This is OpenCT, a middleware framework for smart card
          terminals.
        </p>

        <p>
          It all started with a reader driver library - Olaf Kirch
          wanted to write a library to provide a framework for
          people writing drivers for smart card readers. The idea
          was to provide all the usual stuff (T=0, T=1, serial vs.
          USB device handling, etc) in a single place, and reduce
          driver writing to interaction with the device itself.
        </p>

        <p>
          OpenCT provides a native OpenCT, CT-API and PC/SC Lite
          IFD interface with an OpenCT ifdhandler resource manager.
        </p>

        <p>
          OpenCT is an open source implementation providing card
          terminal drivers. OpenCT was written by Olaf Kirch 

          <tt class="email">
            &lt;

            <a href="mailto:okir@suse.de">
              okir@suse.de
            </a>&gt;
          </tt>with contributions from the following people:
        </p>

        <div class="itemizedlist">
          <ul type="disc">
            <li>
              The checksum code for T=1 (src/ifd/checksum.c) was
              taken from Matthias Bruestle's excellent SCEZ
              library.
            </li>

            <li>
              The e-gate and CCID drivers were contributed, and are
              copyright by, Chaskiel Grundman 

              <tt class="email">
                &lt;

                <a href="mailto:cg2v@andrew.cmu.edu">
                  cg2v@andrew.cmu.edu
                </a>&gt;
              </tt>
            </li>

            <li>
              The eToken, Eutron and Rainbow iKey drivers are based
              on code written by Andreas Jellinghaus 

              <tt class="email">
                &lt;

                <a href="mailto:aj@dungeon.inka.de">
                  aj@dungeon.inka.de
                </a>&gt;
              </tt>
            </li>

            <li>
              Markus Friedl helped with the *BSD port.
            </li>

            <li>
              Support for Solaris was contributed by William
              Wanders.
            </li>

            <li>
              Thanks to Ville Skytt√§ for help with the
              documentation.
            </li>
          </ul>
        </div>
      </div>

      <div class="chapter" lang="en" xml:lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title">
                <a id="openct.copyright">
                </a>Chapter&#160;2.&#160;Copyright and license
              </h2>
            </div>
          </div>

          <div></div>
        </div>

        <p>
          Most of OpenCT is copyright by Olaf Kirch 

          <tt class="email">
            &lt;

            <a href="mailto:okir@suse.de">
              okir@suse.de
            </a>&gt;
          </tt>under BSD license, but see every source file for the
          individual authors.
        </p>
      </div>

      <div class="chapter" lang="en" xml:lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title">
                <a id="openct.supported">
                </a>Chapter&#160;3.&#160;Supported readers and
                tokens
              </h2>
            </div>
          </div>

          <div></div>
        </div>

        <div class="variablelist">
          <dl>
            <dt>
              <span class="term">
                <a href=
                "http://www.towitoko.de/hpeng/prod_micro.htm"
                target="_top">
                  Towitoko CHIPDRIVE micro
                </a>
              </span>
            </dt>

            <dd>
              A cheap and very popular smart card reader for the
              serial interfaces manufactured by 

              <a href="http://www.towitoko.de/" target="_top">
                Towitoko AG
              </a>. Fully supported.
            </dd>

            <dt>
              <span class="term">
                <a href=
                "http://www.kobil.de/e/index.php?s=smartcard"
                target="_top">
                  KOBIL KAAN Professional
                </a>
              </span>
            </dt>

            <dd>
              A smart card reader by 

              <a href="http://www.kobil.de/indexe.html" target=
              "_top">
                KOBIL Systems
              </a>for the serial interfaces. Fully supported.
            </dd>

            <dt>
              <span class="term">
                <a href=
                "http://www.readers.slb.com/Products/e-gate/e-gate.html"
                   target="_top">
                  Schlumberger e-gate
                </a>
              </span>
            </dt>

            <dd>
              A USB token / smart card reader from 

              <a href="http://www.readers.slb.com/" target="_top">
                Schlumberger
              </a>. It was only tested with Schlumberger cyberflex
              32k cards. FIXME: I don't know if that adapter should
              work with other cards as well.
            </dd>

            <dt>
              <span class="term">
                <a href="http://www.ealaddin.com/etoken/PRO/"
                target="_top">
                  Aladdin eToken PRO
                </a>
              </span>
            </dt>

            <dd>
              A USB crypto Token by 

              <a href="http://www.ealaddin.com/" target="_top">
                Aladdin Knowledge Systems
              </a>. Some older versions could have problems with
              non-Intel mainboards. Except for that issue: Fully
              supported.
            </dd>

            <dt>
              <span class="term">
                <a href="http://www.cryptoidentity.eutron.com/"
                target="_top">
                  Eutron CryptoIdentity IT-SEC
                </a>
              </span>
            </dt>

            <dd>
              A USB crypto Token by 

              <a href="http://www.eutron.com/" target="_top">
                Eutron
              </a>. Fully supported.
            </dd>

            <dt>
              <span class="term">
                <a href="http://www.rainbow.com/products/ikey/"
                target="_top">
                  Rainbow iKey 3000
                </a>
              </span>
            </dt>

            <dd>
              A USB crypto Token by 

              <a href="http://www.rainbow.com/" target="_top">
                Rainbow Technologies
              </a>. Fully supported.
            </dd>

            <dt>
              <span class="term">
                <a href=
                "http://www.omnikey.com/en/kat_smartcard.php3"
                target="_top">
                  OMNIKEY CardMan
                </a>
              </span>
            </dt>

            <dd>
              A USB smart card reader. Not fully working as of yet.
            </dd>
          </dl>
        </div>
      </div>

      <div class="chapter" lang="en" xml:lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title">
                <a id="openct.requirements">
                </a>Chapter&#160;4.&#160;Requirements
              </h2>
            </div>
          </div>

          <div></div>
        </div>

        <p>
          To use OpenCT with smart card readers attached to the
          serial port, you only need a kernel with a working serial
          port, nothing special is required.
        </p>

        <p>
          To use OpenCT with smart card readers attached via USB
          you need a bit more: your kernel needs to support the USB
          controller you are using. On most computers the USB
          controller is part of the mainboard. If your mainboard
          uses Intel chips you need most likely the "uhci" USB
          controller support, for other vendors most likely the
          "ohci" controller support.
        </p>

        <p>
          FIXME: Add an URL to a generic USB HOWTO
        </p>

        <p>
          You also need to compile your kernel with support for the
          USB device filesystem and mount the filesystem to 

          <tt class="filename">
            /proc/bus/usb
          </tt>. The kernel option is CONFIG_USB_DEVICEFS, please
          turn it on. To mount the filesystem, please edit your 

          <tt class="filename">
            /etc/fstab
          </tt>. For a Linux kernel 2.4.* system, it should have a
          line
        </p>

        <table border="0" bgcolor="#E0E0E0">
          <tr>
            <td>
              <pre class="screen">
                none    /proc/bus/usb   usbdevfs        defaults   
                    0       0
                                        
              </pre>
            </td>
          </tr>
        </table>

        <p>
          and for a Linux kernel 2.5.* or 2.6.* system, it should
          have a line:
        </p>

        <table border="0" bgcolor="#E0E0E0">
          <tr>
            <td>
              <pre class="screen">
                none    /proc/bus/usb   usbfs           defaults   
                    0       0
                                        
              </pre>
            </td>
          </tr>
        </table>

        <p></p>

        <p>
          Run 

          <tt class="prompt">
            mount -a
          </tt>after editing the file 

          <tt class="filename">
            /etc/fstab
          </tt>for the changes to take effect. You can also reboot.
          If you are using sometimes Linux kernels 2.4.* and
          sometimes 2.5.*/2.6.*, use the line for kernel 2.4.*. You
          will get a warning, but it will still work.
        </p>

        <p>
          Your kernel also needs to be compiled with hotplugging
          support. The relevant kernel option is CONFIG_HOTPLUG.
          You don't need any of the hardware adapters.
        </p>
      </div>

      <div class="chapter" lang="en" xml:lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title">
                <a id="openct.install">
                </a>Chapter&#160;5.&#160;Installation
              </h2>
            </div>
          </div>

          <div></div>
        </div>

        <p>
          First, you need to build the OpenCT libraries and
          utilities. You do this by first invoking the configure
          script, for instance
        </p>

        <table border="0" bgcolor="#E0E0E0">
          <tr>
            <td>
              <pre class="screen">
                % ./configure --prefix=/usr --sysconfdir=/etc
                                        
              </pre>
            </td>
          </tr>
        </table>

        <p></p>

        <p>
          This will try configure OpenCT so it is installed below 

          <tt class="filename">
            /usr
          </tt>, and so that it expects its configuration file 

          <tt class="filename">
            /etc
          </tt>. If you omit the "--sysconfdir" option, OpenCT will
          look for the configuration file in 

          <tt class="filename">
            $PREFIX/etc
          </tt>.
        </p>

        <p>
          Next, you need to compile and install all libraries and
          utilities using
        </p>

        <table border="0" bgcolor="#E0E0E0">
          <tr>
            <td>
              <pre class="screen">
                % make
                % make install
                                        
              </pre>
            </td>
          </tr>
        </table>

        <p></p>

        <p>
          Once that has completed, create the directory 

          <tt class="filename">
            /var/run/openct
          </tt>and set the permissions. Do this with the commands:
        </p>

        <table border="0" bgcolor="#E0E0E0">
          <tr>
            <td>
              <pre class="screen">
                # mkdir /var/run/openct
                # chmod 755 /var/run/openct
                                        
              </pre>
            </td>
          </tr>
        </table>

        <p></p>

        <p>
          These default permissions will allow everyone on your
          system to use smart card readers available via OpenCT.
          For details and a more restrictive setup, please consult
          the 

          <a href="#openct.security" title=
          "Chapter&#160;12.&#160;Security">
            chapter on Security
          </a>.
        </p>

        <p>
          Next, you need the configuration file 

          <tt class="filename">
            openct.conf
          </tt>. The exact location of the file depends on how you
          invoked the 

          <tt class="filename">
            configure
          </tt>script, but using the options shown above, the file
          should go to 

          <tt class="filename">
            /etc
          </tt>:
        </p>

        <table border="0" bgcolor="#E0E0E0">
          <tr>
            <td>
              <pre class="screen">
                # cp etc/openct.conf /etc/
                                        
              </pre>
            </td>
          </tr>
        </table>

        <p></p>

        <p>
          You need to edit the config file for any serial reader
          you might have. If you are only using USB tokens, the
          default file is already fine.
        </p>

        <p>
          Third you need an init script to perform some operations
          on startup and shutdown. OpenCT ships with an init script
          that should work at least on Debian systems. Install the
          script by copying it from the source directory:
        </p>

        <table border="0" bgcolor="#E0E0E0">
          <tr>
            <td>
              <pre class="screen">
                # cp etc/init-script /etc/init.d/openct
                                        
              </pre>
            </td>
          </tr>
        </table>

        <p></p>

        <p>
          Now configure your runlevels to start the init script
          every time the system boots, and to stop the init script
          every time the system shuts down. Use whatever your
          distribution provides or a GUI tool like the KDE runlevel
          editor.
        </p>

        <p>
          Debian users can do this with a single command:
        </p>

        <table border="0" bgcolor="#E0E0E0">
          <tr>
            <td>
              <pre class="screen">
                # update-rc.d openct start 99 2 3 4 5 . stop 01 0 1
                6 .
                 Adding system startup for /etc/init.d/openct ...
                   /etc/rc0.d/K01openct -&gt; ../init.d/openct
                   /etc/rc1.d/K01openct -&gt; ../init.d/openct
                   /etc/rc6.d/K01openct -&gt; ../init.d/openct
                   /etc/rc2.d/S99openct -&gt; ../init.d/openct
                   /etc/rc3.d/S99openct -&gt; ../init.d/openct
                   /etc/rc4.d/S99openct -&gt; ../init.d/openct
                   /etc/rc5.d/S99openct -&gt; ../init.d/openct
                #
                                        
              </pre>
            </td>
          </tr>
        </table>

        <p></p>

        <p>
          Call the init script once with "start". Or reboot. :-)
        </p>

        <table border="0" bgcolor="#E0E0E0">
          <tr>
            <td>
              <pre class="screen">
                # /etc/init.d/openct start
                                        
              </pre>
            </td>
          </tr>
        </table>

        <p></p>

        <p>
          And now the last task: if you want to use USB readers or
          USB crypto tokens, you need to configure the hotplug
          system to call openct every time there is a new smart
          card reader or crypto token. The future releases will
          work better without hotplug scripts because of multi-OS
          support issues. For now, we recommend you to install
          Linux hotplug package before installing OpenCT. After
          that, the standard install mechanism should add all
          required files correctly to directory 

          <tt class="filename">
            /etc/hotplug
          </tt>.
        </p>
      </div>

      <div class="chapter" lang="en" xml:lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title">
                <a id="openct.debug">
                </a>Chapter&#160;6.&#160;Debugging
              </h2>
            </div>
          </div>

          <div></div>
        </div>

        <p>
          Edit 

          <tt class="filename">
            openct.conf
          </tt>and set debug to 4.
        </p>

        <p>
          If the problem is with some USB crypto token, please grep
          for usb_control - these are the lines we need to see what
          is happening.
        </p>
      </div>

      <div class="chapter" lang="en" xml:lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title">
                <a id="openct.files">
                </a>Chapter&#160;7.&#160;OpenCT files and tools
              </h2>
            </div>
          </div>

          <div></div>
        </div>

        <div class="toc">
          <p>
            <b>
              Table of Contents
            </b>
          </p>

          <dl>
            <dt>
              <span class="section">
                <a href="#openct.files.varrunopenct">
                  /var/run/openct - OpenCT status directory
                </a>
              </span>
            </dt>

            <dt>
              <span class="section">
                <a href="#openct.files.sbinopenctcontrol">
                  sbin/openct-control - OpenCT manager
                </a>
              </span>
            </dt>

            <dt>
              <span class="section">
                <a href="#openct.files.sbinifdhandler">
                  sbin/ifdhandler - OpenCT device handler
                </a>
              </span>
            </dt>

            <dt>
              <span class="section">
                <a href="#openct.files.opencttool">
                  bin/openct-tool
                </a>
              </span>
            </dt>

            <dt>
              <span class="section">
                <a href="#openct.files.openctconf">
                  etc/openct.conf
                </a>
              </span>
            </dt>
          </dl>
        </div>

        <p>
          This chapter will list all tools and files and explain
          what they do.
        </p>

        <div class="section" lang="en" xml:lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title" style="clear: both">
                  <a id="openct.files.varrunopenct">
                  </a>/var/run/openct - OpenCT status directory
                </h2>
              </div>
            </div>

            <div></div>
          </div>

          <p>
            This directory holds status files for OpenCT. Create it
            with:
          </p>

          <table border="0" bgcolor="#E0E0E0">
            <tr>
              <td>
                <pre class="screen">
                  mkdir /var/run/openct
                  chmod 755 /var/run/openct
                                                  
                </pre>
              </td>
            </tr>
          </table>

          <p></p>

          <p>
            By default everyone can use smart cards via OpenCT. You
            can create a group "openct", assign users to that
            group, and limit access to smart cards via openct like
            this:
          </p>

          <table border="0" bgcolor="#E0E0E0">
            <tr>
              <td>
                <pre class="screen">
                  chgrp openct /var/run/openct
                  chmod 750 /var/run/openct
                                                  
                </pre>
              </td>
            </tr>
          </table>

          <p></p>
        </div>

        <div class="section" lang="en" xml:lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title" style="clear: both">
                  <a id="openct.files.sbinopenctcontrol">
                  </a>sbin/openct-control - OpenCT manager
                </h2>
              </div>
            </div>

            <div></div>
          </div>

          <p>
            Run openct-control once to setup the 

            <tt class="filename">
              status
            </tt>file in 

            <tt class="filename">
              /var/run/openct
            </tt>. Without that file OpenCT will not work.
          </p>

          <p></p>

          <table border="0" bgcolor="#E0E0E0">
            <tr>
              <td>
                <pre class="screen">
                  # /usr/sbin/openct-control
                  usage: openct-control [-d] [-f configfile]
                  command
                    -d   enable debugging; repeat to increase
                  verbosity
                    -n   disable coldplugging
                    -f   specify config file (default
                  /etc/openct.conf)
                    -h   display this message

                  Where command is one of:
                  init - initialize OpenCT
                  attach device ident - attach a hotplug device
                  status - display status of all readers present
                  shutdown - shutdown OpenCT
                                                  
                </pre>
              </td>
            </tr>
          </table>

          <p></p>
        </div>

        <div class="section" lang="en" xml:lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title" style="clear: both">
                  <a id="openct.files.sbinifdhandler">
                  </a>sbin/ifdhandler - OpenCT device handler
                </h2>
              </div>
            </div>

            <div></div>
          </div>

          <p>
            This app is called by openct-control to handle one
            device, e.g. a smart card reader or an USB token.
          </p>

          <p></p>

          <table border="0" bgcolor="#E0E0E0">
            <tr>
              <td>
                <pre class="screen">
                  # /usr/sbin/ifdhandler
                  usage: ifdhandler [-Hds] [-r reader] driver
                  [device]
                    -r   specify index of reader
                    -F   stay in foreground
                    -H   hotplug device, monitor for detach
                    -s   send error and debug messages to syslog
                    -d   enable debugging; repeat to increase
                  verbosity
                    -h   display this message
                                                  
                </pre>
              </td>
            </tr>
          </table>

          <p></p>
        </div>

        <div class="section" lang="en" xml:lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title" style="clear: both">
                  <a id="openct.files.opencttool">
                  </a>bin/openct-tool
                </h2>
              </div>
            </div>

            <div></div>
          </div>

          <p></p>

          <table border="0" bgcolor="#E0E0E0">
            <tr>
              <td>
                <pre class="screen">
                  # /usr/bin/openct-tool
                  usage: openct-tool [-d] [-f configfile] [-r
                  reader] command ...
                    -d   enable debugging; repeat to increase
                  verbosity
                    -f   specify config file (default
                  /etc/openct.conf)
                    -r   specify index of reader to use
                    -h   display this message

                  command: can be one of the following
                   list  list all readers found
                   atr   print ATR of card in selected reader
                   wait  wait for card to be inserted
                   rwait wait for reader to attached
                   mf    try to select main folder of card
                   read  dump memory of synchronous card
                                                  
                </pre>
              </td>
            </tr>
          </table>

          <p></p>
        </div>

        <div class="section" lang="en" xml:lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title" style="clear: both">
                  <a id="openct.files.openctconf">
                  </a>etc/openct.conf
                </h2>
              </div>
            </div>

            <div></div>
          </div>

          <p></p>

          <table border="0" bgcolor="#E0E0E0">
            <tr>
              <td>
                <pre class="screen">
                  # Set debug level
                  debug   = 0;
                  #
                  # Enable hot plugging
                  hotplug = yes;
                  #
                  # Path to ifdhandler
                  ifdhandler = /usr/sbin/ifdhandler;

                  # Configure static, non-hotplug aware readers
                  here
                  #
                  # For a list of drivers try command 'ifdhandler
                  -i', please
                  # notice that not all drivers have serial device
                  capability.

                  #reader towitoko {
                  #       driver = towitoko;
                  #       device = serial:/dev/ttyS0;
                  #};

                  #
                  # Hotplug IDs
                  driver  egate {
                          ids = {
                                  usb:0973/0001,
                          };
                  };
                  driver  etoken {
                          ids = {
                                  usb:0529/050c,
                                  usb:0529/0514,
                          };
                  };
                  driver  eutron {
                          ids = {
                                  usb:073d/0005,
                          };
                  };
                  driver  ikey2k {
                          ids = {
                                  usb:04b9/1202,
                          };
                  };
                  driver  ikey3k {
                          ids = {
                                  usb:04b9/1300,
                          };
                  };
                  driver  cardman {
                          ids = {
                                  usb:076b/0596,
                          };
                  };
                                                  
                </pre>
              </td>
            </tr>
          </table>

          <p></p>
        </div>
      </div>

      <div class="chapter" lang="en" xml:lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title">
                <a id="openct.ct-api">
                </a>Chapter&#160;8.&#160;Using OpenCT via CT-API
                interface
              </h2>
            </div>
          </div>

          <div></div>
        </div>

        <p>
          Install and configure the file 

          <tt class="filename">
            /etc/openct.conf
          </tt>as discussed. Configure your CT-API application to
          load 

          <tt class="filename">
            lib/libopenctapi.so
          </tt>.
        </p>
      </div>

      <div class="chapter" lang="en" xml:lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title">
                <a id="openct.pcsc"></a>Chapter&#160;9.&#160;Using
                OpenCT via PC/SC Lite
              </h2>
            </div>
          </div>

          <div></div>
        </div>

        <p>
          Install and configure the file 

          <tt class="filename">
            /etc/openct.conf
          </tt>as discussed. Configure PC/SC Lite /etc/reader.conf
          to load 

          <tt class="filename">
            lib/openct-ifd.so
          </tt>.
        </p>

        <p></p>

        <table border="0" bgcolor="#E0E0E0">
          <tr>
            <td>
              <pre class="screen">
                FRIENDLYNAME     "OpenCT"
                DEVICENAME       OPENCT_DEV
                LIBPATH          /usr/lib/openct-ifd.so
                CHANNELID        1
                                        
              </pre>
            </td>
          </tr>
        </table>

        <p></p>
      </div>

      <div class="chapter" lang="en" xml:lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title">
                <a id="openct.library">
                </a>Chapter&#160;10.&#160;Writing smart card
                applications using OpenCT
              </h2>
            </div>
          </div>

          <div></div>
        </div>

        <p>
          OpenCT has a proprietary, but very easy to use interface.
          Take a look at the header files 

          <tt class="filename">
            include/openct/*.h
          </tt>and the library 

          <tt class="filename">
            lib/libopenct.*
          </tt>.
        </p>

        <p>
          If your application uses autoconf, we made it easy for
          you to search for OpenCT and link with libopenct by
          shipping OpenCT with a pkg-config file: 

          <tt class="filename">
            lib/pkg-config/libopenct.pc
          </tt>
        </p>

        <p>
          See the pkg-config man page for detailed information.
        </p>
      </div>

      <div class="chapter" lang="en" xml:lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title">
                <a id="openct.trouble">
                </a>Chapter&#160;11.&#160;Troubleshooting
              </h2>
            </div>
          </div>

          <div></div>
        </div>

        <div class="toc">
          <p>
            <b>
              Table of Contents
            </b>
          </p>

          <dl>
            <dt>
              <span class="section">
                <a href="#openct.trouble.usb">
                  Problems with USB devices
                </a>
              </span>
            </dt>
          </dl>
        </div>

        <p>
          If something does not work, please join the OpenSC
          mailing list and ask for help. For details on the mailing
          list take a look at 

          <a href="http://www.opensc.org/" target="_top">
            http://www.opensc.org/
          </a>
        </p>

        <p>
          If you try to use a USB device, please try this: Do you
          have a 

          <tt class="filename">
            /proc
          </tt>filesystem? This command should work: 

          <tt class="prompt">
            ls /proc/sys
          </tt>
        </p>

        <p>
          Is your kernel compiled with USB support? Does the USB
          support work? This command should list all USB devices: 

          <tt class="prompt">
            lsusb
          </tt>
        </p>

        <p>
          Is your kernel compiled with hotplugging support? This
          command give the same output on your system:
        </p>

        <table border="0" bgcolor="#E0E0E0">
          <tr>
            <td>
              <pre class="screen">
                % cat /proc/sys/kernel/hotplug
                /sbin/hotplug
                %
                                        
              </pre>
            </td>
          </tr>
        </table>

        <p></p>

        <p>
          Do you have a hotplug script? This command should work: 

          <tt class="prompt">
            ls /sbin/hotplug
          </tt>
        </p>

        <p>
          Did you create the directory 

          <tt class="filename">
            /var/run/openct
          </tt>? What files are in there? What are the file
          permissions? Try this command, it should work and give
          you a similar output:
        </p>

        <table border="0" bgcolor="#E0E0E0">
          <tr>
            <td>
              <pre class="screen">
                % ls -la /var/run/openct/
                total 8
                drwxr-xr-x    2 root     root         4096
                2003-07-02 08:13 ./
                drwxr-xr-x    8 root     root         4096
                2003-07-02 08:13 ../
                -rw-r--r--    1 root     root         1728
                2003-07-02 08:13 status
                %
                                        
              </pre>
            </td>
          </tr>
        </table>

        <p>
          See the 

          <a href="#openct.security" title=
          "Chapter&#160;12.&#160;Security">
            security chapter
          </a>for details on file permissions of this directory.
        </p>

        <div class="section" lang="en" xml:lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title" style="clear: both">
                  <a id="openct.trouble.usb"></a>Problems with USB
                  devices
                </h2>
              </div>
            </div>

            <div></div>
          </div>

          <p>
            Are you using an USB smart card reader or USB crypto
            token? What is it's USB vendor and product id? 

            <tt class="prompt">
              lsusb
            </tt>will tell you.
          </p>

          <p>
            Is that product id listed in 

            <tt class="filename">
              openct.conf
            </tt>? If not, please add it.
          </p>

          <p>
            If you have a file 

            <tt class="filename">
              /etc/hotplug/usb/openct.usermap
            </tt>, is the vendor and product id listed in that
            file?
          </p>

          <p>
            If that solves the problem, please let the OpenCT
            developers know, so we can improve the default
            configuration and documentation. You can reach us using
            the OpenSC developer mailing list at 

            <tt class="email">
              &lt;

              <a href="mailto:opensc-devel@opensc.org">
                opensc-devel@opensc.org
              </a>&gt;
            </tt>.
          </p>
        </div>
      </div>

      <div class="chapter" lang="en" xml:lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title">
                <a id="openct.security">
                </a>Chapter&#160;12.&#160;Security
              </h2>
            </div>
          </div>

          <div></div>
        </div>

        <p>
          The default setting is not very secure: all users can
          access your smart card readers. Several processes can use
          the same smart card reader at the same time, but they
          always have to be owned by the same users. (FIXME: is it
          necessary to issue a LOCK command for this, or will it
          always work like this?)
        </p>

        <p>
          You can restrict access to smart card readers using
          OpenCT to one user with these commands:
        </p>

        <table border="0" bgcolor="#E0E0E0">
          <tr>
            <td>
              <pre class="screen">
                # chown user /var/run/openct
                # chmod 700 /var/run/openct
                                        
              </pre>
            </td>
          </tr>
        </table>

        <p></p>

        <p>
          You can also create a group, add users to that group and
          restrict access to smart card readers using OpenCT to
          that group with these commands:
        </p>

        <table border="0" bgcolor="#E0E0E0">
          <tr>
            <td>
              <pre class="screen">
                # chgrp group /var/run/openct
                # chmod 750 /var/run/openct
                                        
              </pre>
            </td>
          </tr>
        </table>

        <p></p>

        <p>
          In both cases root can still access the smart card
          readers. Replace 

          <i class="replaceable">
            <tt>
              user
            </tt>
          </i>and 

          <i class="replaceable">
            <tt>
              group
            </tt>
          </i>with the user and group of your choice.
        </p>

        <p>
          If you want all users to be able to access smart card
          readers using OpenCT:
        </p>

        <table border="0" bgcolor="#E0E0E0">
          <tr>
            <td>
              <pre class="screen">
                # chmod 755 /var/run/openct
                                        
              </pre>
            </td>
          </tr>
        </table>

        <p></p>
      </div>
    </div>
  </body>
</html>
